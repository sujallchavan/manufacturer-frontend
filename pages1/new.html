<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>User Management Dashboard</title>

    <!-- Fonts -->
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css?family=Inter:300,400,500,600,700,900"
    />

    <!-- Icons -->
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@24,400,0,0"
    />
    <script
      src="https://kit.fontawesome.com/42d5adcbca.js"
      crossorigin="anonymous"
    ></script>

    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <!-- Custom CSS -->
    <style>
      body {
        background-color: #f8f9fa;
        font-family: "Inter", sans-serif;
        overflow-x: hidden;
      }

      .sidebar {
        background: #fff;
        height: 100vh;
        position: fixed;
        box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
        width: 280px;
        transition: all 0.3s ease;
        z-index: 1000;
      }

      .main-content {
        margin-left: 280px;
        padding: 20px;
        transition: all 0.3s ease;
      }

      .card {
        border: none;
        border-radius: 10px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        margin-bottom: 20px;
      }

      .card-header {
        background: #fff;
        border-bottom: 1px solid #eee;
        font-weight: 600;
      }

      .stat-card {
        transition: transform 0.3s;
      }

      .stat-card:hover {
        transform: translateY(-5px);
      }

      .stat-icon {
        font-size: 2rem;
        opacity: 0.8;
      }

      .nav-link {
        color: #495057;
        border-radius: 5px;
        margin: 5px 0;
      }

      .nav-link:hover,
      .nav-link.active {
        background: #43a047;
        color: white !important;
      }

      .table-responsive {
        border-radius: 10px;
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
      }

      table {
        margin-bottom: 0 !important;
        min-width: 600px;
      }

      .search-box {
        max-width: 300px;
        margin-left: auto;
      }

      .badge-customer {
        background-color: #4e73df;
      }
      .badge-supplier {
        background-color: #1cc88a;
      }
      .badge-manufacturer {
        background-color: #f6c23e;
      }

      /* Action buttons */
      .action-btn {
        padding: 5px 10px;
        margin: 0 2px;
        border: none;
        border-radius: 3px;
        cursor: pointer;
      }
      .edit-btn {
        background-color: #2196f3;
        color: white;
      }
      .delete-btn {
        background-color: #f44336;
        color: white;
      }
      .action-btn:hover {
        opacity: 0.8;
      }

      /* Modal styles */
      .modal-content {
        border-radius: 10px;
      }
      .form-group {
        margin-bottom: 15px;
      }
      .form-group label {
        display: block;
        margin-bottom: 5px;
        font-weight: bold;
      }
      .form-group input {
        width: 100%;
        padding: 8px;
        box-sizing: border-box;
        border: 1px solid #ddd;
        border-radius: 4px;
      }
      .save-btn {
        background-color: #4caf50;
        color: white;
        padding: 10px 15px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
      }
      .save-btn:hover {
        background-color: #45a049;
      }

      /* Mobile Styles */
      @media (max-width: 992px) {
        .sidebar {
          transform: translateX(-100%);
          width: 280px;
        }

        .sidebar.active {
          transform: translateX(0);
        }

        .main-content {
          margin-left: 0;
        }

        .overlay {
          position: fixed;
          top: 0;
          left: 0;
          right: 0;
          bottom: 0;
          background: rgba(0, 0, 0, 0.5);
          z-index: 999;
          display: none;
        }

        .overlay.active {
          display: block;
        }

        .search-box {
          max-width: 100%;
          margin-top: 10px;
        }
      }

      /* Hamburger Menu */
      .hamburger {
        display: none;
        cursor: pointer;
        padding: 10px;
        margin-right: 15px;
      }

      .hamburger span {
        display: block;
        width: 25px;
        height: 3px;
        background: #333;
        margin: 5px 0;
        transition: all 0.3s;
      }

      @media (max-width: 992px) {
        .hamburger {
          display: block;
        }
      }

      /* Close icon animation */
      .hamburger.close-sidebar span:nth-child(1) {
        transform: rotate(45deg) translate(5px, 5px);
      }
      .hamburger.close-sidebar span:nth-child(2) {
        opacity: 0;
      }
      .hamburger.close-sidebar span:nth-child(3) {
        transform: rotate(-45deg) translate(5px, -5px);
      }
    </style>
  </head>

  <body>
    <!-- Session Validation Script -->
    <script>
      // Check if user is logged in
      document.addEventListener("DOMContentLoaded", function () {
        const userEmail = sessionStorage.getItem("userEmail");

        if (!userEmail) {
          alert("You must be logged in to access this page!");
          window.location.href = "sign-in.html"; // Redirect to login page
          return;
        }

        // If logged in, continue loading the page
        fetchCustomers();
        fetchSuppliers();

        // Set up logout button
        document
          .getElementById("logoutBtn")
          .addEventListener("click", async function () {
            try {
              const response = await fetch(
                "http://localhost:5000/api/manufacturer/logout",
                {
                  method: "POST",
                  credentials: "include",
                }
              );

              if (!response.ok) throw new Error("Logout failed");

              sessionStorage.removeItem("userEmail");
              alert("Logged out successfully!");
              window.location.href = "sign-in.html";
            } catch (error) {
              console.error("Error logging out:", error);
            }
          });
      });
    </script>

    <!-- Overlay for mobile sidebar -->
    <div class="overlay"></div>

    <!-- Sidebar -->
    <!-- Sidebar -->
    <div class="sidebar col-md-3 col-lg-2 d-md-block">
      <div class="p-3">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <a class="navbar-brand d-flex align-items-center" href="#">
            <img
              src="../assets/img/logo-ct-dark.png"
              width="30"
              height="30"
              class="me-2"
            />
            <span class="font-weight-bold">Manufacturer</span>
          </a>
          <div class="hamburger close-sidebar d-lg-none">
            <span></span>
            <span></span>
            <span></span>
          </div>
        </div>
        <hr />

        <ul class="nav flex-column">
          <li class="nav-item">
            <a class="nav-link" href="dashboard.html">
              <i class="material-symbols-rounded me-2">dashboard</i>
              Dashboard
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#">
              <i class="material-symbols-rounded me-2">table_view</i>
              Projects
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#">
              <i class="material-symbols-rounded me-2">receipt_long</i>
              Orders
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="new.html">
              <i class="material-symbols-rounded me-2">notifications</i>
              Notifications
              <span class="badge bg-danger ms-2" id="approvedCount">0</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link active" href="new.html">
              <i class="material-symbols-rounded me-2">group</i>
              User Management
            </a>
          </li>
          <li class="nav-item mt-3">
            <h6 class="text-uppercase text-muted small fw-bold px-3">
              Account
            </h6>
          </li>
          <li class="nav-item">
            <a
              class="nav-link"
              href="#"
              data-bs-toggle="modal"
              data-bs-target="#profileModal"
            >
              <i class="material-symbols-rounded me-2">person</i>
              Profile
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#" id="logoutBtn">
              <i class="material-symbols-rounded me-2">logout</i>
              Logout
            </a>
          </li>
        </ul>
      </div>
    </div>
    <!-- Profile Modal -->
    <div class="modal fade" id="profileModal" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Admin Profile</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <div class="text-center mb-4">
              <div
                class="avatar avatar-xl bg-gradient-primary rounded-circle mb-3"
              >
                <i class="material-symbols-rounded text-white">person</i>
              </div>
              <h4 id="modalUserName">Loading...</h4>
              <p class="text-muted" id="modalUserEmail">Loading...</p>
            </div>
            <div class="row">
              <div class="col-md-6 mb-3">
                <label class="form-label">Admin ID</label>
                <input
                  type="text"
                  class="form-control"
                  id="customerId"
                  readonly
                />
              </div>
              <div class="col-md-6 mb-3">
                <label class="form-label">Phone</label>
                <input
                  type="text"
                  class="form-control"
                  id="phone_number"
                  readonly
                />
              </div>
              <div class="col-12 mb-3">
                <label class="form-label">Location</label>
                <input
                  type="text"
                  class="form-control"
                  id="customerLocation"
                  readonly
                />
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Close
            </button>
            <button type="button" class="btn btn-primary">Save Changes</button>
          </div>
        </div>
      </div>
    </div>
    <!-- Main Content -->
    <div class="main-content">
      <!-- Header -->
      <header class="d-flex justify-content-between align-items-center mb-4">
        <div class="d-flex align-items-center">
          <div class="hamburger open-sidebar me-3 d-lg-none">
            <span></span>
            <span></span>
            <span></span>
          </div>
          <div>
            <h3 class="mb-0">User Management</h3>
            <p class="text-muted mb-0">Manage all customers and suppliers</p>
          </div>
        </div>
        <div class="d-flex align-items-center">
          <div class="input-group search-box d-none d-md-flex">
            <input
              type="text"
              class="form-control"
              placeholder="Search users..."
              id="globalSearch"
            />
            <button class="btn btn-outline-secondary" type="button">
              <i class="material-symbols-rounded">search</i>
            </button>
          </div>
        </div>
      </header>

      <!-- Stats Cards -->
      <div class="row">
        <div class="col-md-6">
          <div class="card stat-card">
            <div class="card-body">
              <div class="d-flex justify-content-between">
                <div>
                  <h6 class="text-muted mb-2">Total Customers</h6>
                  <h3 class="mb-0" id="customerCount">0</h3>
                </div>
                <div
                  class="stat-icon bg-gradient-primary text-white rounded-circle p-3"
                >
                  <i class="material-symbols-rounded">person</i>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="col-md-6">
          <div class="card stat-card">
            <div class="card-body">
              <div class="d-flex justify-content-between">
                <div>
                  <h6 class="text-muted mb-2">Total Suppliers</h6>
                  <h3 class="mb-0" id="supplierCount">0</h3>
                </div>
                <div
                  class="stat-icon bg-gradient-success text-white rounded-circle p-3"
                >
                  <i class="material-symbols-rounded">local_shipping</i>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Customers Section -->
      <div class="card mt-4 p-3">
        <!-- Header -->
        <div
          class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center mb-3"
        >
          <h5 class="d-flex align-items-center mb-2 mb-md-0">
            <span class="badge bg-primary text-white me-2">C</span> Customers
          </h5>
          <button class="btn btn-primary" onclick="openAddCustomerModal()">
            <i class="material-symbols-rounded me-1">add</i>
            Add Customer
          </button>
        </div>

        <!-- Search Bar -->
        <div class="input-group mb-4">
          <span class="input-group-text border-primary text-primary bg-white">
            <i class="material-symbols-rounded">search</i>
          </span>
          <input
            type="text"
            id="customerSearch"
            class="form-control border-primary"
            placeholder="Search by name, email, location..."
            onkeyup="searchTable('customerSearch', 'customerTableBody')"
          />
        </div>

        <!-- Table -->
        <div class="table-responsive">
          <table class="table table-hover" id="customerTable">
            <thead class="table-light">
              <tr>
                <th>Customer ID</th>
                <th>Name</th>
                <th>Email</th>
                <th>Location</th>
                <th>Phone Number</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="customerTableBody">
              <!-- Customer rows go here -->
            </tbody>
          </table>
        </div>
      </div>

      <!-- Suppliers Table -->
      <div class="card mt-4">
        <div
          class="card-header d-flex justify-content-between align-items-center"
        >
          <h5 class="mb-0">
            <span class="badge badge-supplier text-white me-2">S</span>
            Suppliers
          </h5>

          <button
            class="btn btn-sm btn-primary"
            onclick="openAddSupplierModal()"
          >
            <i class="material-symbols-rounded me-1">add</i>
            Add Supplier
          </button>
        </div>

        <div class="card-body">
          <!-- Search Bar -->
          <div class="input-group mb-3">
            <span class="input-group-text border-primary text-primary bg-white">
              <i class="material-symbols-rounded">search</i>
            </span>
            <input
              type="text"
              id="supplierSearch"
              class="form-control border-primary"
              placeholder="Search by name, email, location..."
              onkeyup="searchTable('supplierSearch', 'supplierTableBody')"
            />
          </div>

          <!-- Supplier Table -->
          <div class="table-responsive">
            <table class="table table-hover" id="supplierTable">
              <thead class="table-light">
                <tr>
                  <th>Supplier ID</th>
                  <th>Name</th>
                  <th>Email</th>
                  <th>Category</th>
                  <th>Company</th>
                  <th>Location</th>
                  <th>Phone</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="supplierTableBody">
                <!-- Example rows (replace with dynamic data) -->
                <tr>
                  <td>1001</td>
                  <td>Raj Patel</td>
                  <td>raj@example.com</td>
                  <td>Electrical</td>
                  <td>BrightTech</td>
                  <td>Mumbai</td>
                  <td>9876543210</td>
                  <td>
                    <button class="btn btn-sm btn-primary">Edit</button>
                    <button class="btn btn-sm btn-danger">Delete</button>
                  </td>
                </tr>
                <tr>
                  <td>1002</td>
                  <td>Sunita Rao</td>
                  <td>sunita@example.com</td>
                  <td>Mechanical</td>
                  <td>GearWorks</td>
                  <td>Pune</td>
                  <td>9123456780</td>
                  <td>
                    <button class="btn btn-sm btn-primary">Edit</button>
                    <button class="btn btn-sm btn-danger">Delete</button>
                  </td>
                </tr>
                <!-- Add more supplier rows dynamically -->
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- Customer Edit Modal -->
    <div class="modal fade" id="customerModal" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Edit Customer</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
              onclick="closeModal('customerModal')"
            ></button>
          </div>
          <div class="modal-body">
            <form id="customerForm">
              <input type="hidden" id="customerId" />
              <div class="form-group">
                <label for="customerName">Name:</label>
                <input
                  type="text"
                  id="customerName"
                  class="form-control"
                  required
                />
              </div>
              <div class="form-group">
                <label for="customerEmail">Email:</label>
                <input
                  type="email"
                  id="customerEmail"
                  class="form-control"
                  required
                />
              </div>
              <div class="form-group">
                <label for="customerLocation">Location:</label>
                <input
                  type="text"
                  id="customerLocation"
                  class="form-control"
                  required
                />
              </div>
              <div class="form-group">
                <label for="customerPhone">Phone Number:</label>
                <input
                  type="text"
                  id="customerPhone"
                  class="form-control"
                  required
                />
              </div>
              <div class="form-group">
                <label for="customerPassword">Password:</label>
                <input
                  type="password"
                  id="customerPassword"
                  class="form-control"
                  required
                />
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
              onclick="closeModal('customerModal')"
            >
              Close
            </button>
            <button
              type="button"
              class="btn btn-primary"
              onclick="saveCustomerChanges()"
            >
              Save Changes
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Add Customer Modal -->
    <div
      class="modal fade"
      id="addCustomerModal"
      tabindex="-1"
      aria-hidden="true"
    >
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Add New Customer</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
              onclick="closeModal('addCustomerModal')"
            ></button>
          </div>
          <div class="modal-body">
            <form id="addCustomerForm">
              <div class="form-group">
                <label for="newCustomerName">Name:</label>
                <input
                  type="text"
                  id="newCustomerName"
                  class="form-control"
                  required
                />
              </div>
              <div class="form-group">
                <label for="newCustomerEmail">Email:</label>
                <input
                  type="email"
                  id="newCustomerEmail"
                  class="form-control"
                  required
                />
              </div>
              <div class="form-group">
                <label for="newCustomerLocation">Location:</label>
                <input
                  type="text"
                  id="newCustomerLocation"
                  class="form-control"
                  required
                />
              </div>
              <div class="form-group">
                <label for="newCustomerPhone">Phone Number:</label>
                <input
                  type="text"
                  id="newCustomerPhone"
                  class="form-control"
                  required
                />
              </div>
              <div class="form-group">
                <label for="newCustomerPassword">Password:</label>
                <input
                  type="password"
                  id="newCustomerPassword"
                  class="form-control"
                  required
                />
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
              onclick="closeModal('addCustomerModal')"
            >
              Close
            </button>
            <button
              type="button"
              class="btn btn-primary"
              onclick="addNewCustomer()"
            >
              Add Customer
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Supplier Edit Modal -->
    <div class="modal fade" id="supplierModal" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Edit Supplier</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
              onclick="closeModal('supplierModal')"
            ></button>
          </div>
          <div class="modal-body">
            <form id="supplierForm">
              <input type="hidden" id="supplierId" />
              <div class="form-group">
                <label for="supplierName">Name:</label>
                <input
                  type="text"
                  id="supplierName"
                  class="form-control"
                  required
                />
              </div>
              <div class="form-group">
                <label for="supplierEmail">Email:</label>
                <input
                  type="email"
                  id="supplierEmail"
                  class="form-control"
                  required
                />
              </div>
              <div class="form-group">
                <label for="supplierCategory">Category:</label>
                <input
                  type="text"
                  id="supplierCategory"
                  class="form-control"
                  required
                />
              </div>
              <div class="form-group">
                <label for="supplierCompany">Company:</label>
                <input
                  type="text"
                  id="supplierCompany"
                  class="form-control"
                  required
                />
              </div>
              <div class="form-group">
                <label for="supplierLocation">Location:</label>
                <input
                  type="text"
                  id="supplierLocation"
                  class="form-control"
                  required
                />
              </div>
              <div class="form-group">
                <label for="supplierPhone">Phone:</label>
                <input
                  type="text"
                  id="supplierPhone"
                  class="form-control"
                  required
                />
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
              onclick="closeModal('supplierModal')"
            >
              Close
            </button>
            <button
              type="button"
              class="btn btn-primary"
              onclick="saveSupplierChanges()"
            >
              Save Changes
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Add Supplier Modal -->
    <div
      class="modal fade"
      id="addSupplierModal"
      tabindex="-1"
      aria-hidden="true"
    >
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Add New Supplier</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
              onclick="closeModal('addSupplierModal')"
            ></button>
          </div>
          <div class="modal-body">
            <form id="addSupplierForm">
              <div class="form-group">
                <label for="newSupplierName">Name:</label>
                <input
                  type="text"
                  id="newSupplierName"
                  class="form-control"
                  required
                />
              </div>
              <div class="form-group">
                <label for="newSupplierEmail">Email:</label>
                <input
                  type="email"
                  id="newSupplierEmail"
                  class="form-control"
                  required
                />
              </div>
              <div class="form-group">
                <label for="newSupplierCategory">Category:</label>
                <input
                  type="text"
                  id="newSupplierCategory"
                  class="form-control"
                  required
                />
              </div>
              <div class="form-group">
                <label for="newSupplierCompany">Company:</label>
                <input
                  type="text"
                  id="newSupplierCompany"
                  class="form-control"
                  required
                />
              </div>
              <div class="form-group">
                <label for="newSupplierLocation">Location:</label>
                <input
                  type="text"
                  id="newSupplierLocation"
                  class="form-control"
                  required
                />
              </div>
              <div class="form-group">
                <label for="newSupplierPhone">Phone:</label>
                <input
                  type="text"
                  id="newSupplierPhone"
                  class="form-control"
                  required
                />
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
              onclick="closeModal('addSupplierModal')"
            >
              Close
            </button>
            <button
              type="button"
              class="btn btn-primary"
              onclick="addNewSupplier()"
            >
              Add Supplier
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- JavaScript Functions -->
    <script>
      // Mobile sidebar toggle
      document
        .querySelector(".open-sidebar")
        .addEventListener("click", function () {
          document.querySelector(".sidebar").classList.add("active");
          document.querySelector(".overlay").classList.add("active");
        });

      document
        .querySelector(".close-sidebar")
        .addEventListener("click", function () {
          document.querySelector(".sidebar").classList.remove("active");
          document.querySelector(".overlay").classList.remove("active");
        });

      document.querySelector(".overlay").addEventListener("click", function () {
        document.querySelector(".sidebar").classList.remove("active");
        this.classList.remove("active");
      });

      // Update stats counters
      function updateStats(customers, suppliers) {
        document.getElementById("customerCount").textContent = customers.length;
        document.getElementById("supplierCount").textContent = suppliers.length;
      }

      // Fetch and display customers
      async function fetchCustomers() {
        try {
          const response = await fetch(
            "http://localhost:5000/api/manufacturer/customers",
            {
              credentials: "include",
            }
          );

          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }

          const customers = await response.json();
          displayCustomers(customers);
          // Update stats
          const suppliersResponse = await fetch(
            "http://localhost:5000/api/manufacturer/suppliers",
            {
              credentials: "include",
            }
          );
          if (suppliersResponse.ok) {
            const suppliers = await suppliersResponse.json();
            updateStats(customers, suppliers);
          }
        } catch (error) {
          console.error("Error fetching customer data:", error);
          alert("Error fetching customer data. Check console for details.");
        }
      }

      function displayCustomers(customers) {
        const tableBody = document.getElementById("customerTableBody");
        tableBody.innerHTML = "";

        customers.forEach((customer) => {
          const row = document.createElement("tr");

          row.innerHTML = `
                    <td>${customer.customer_id || "N/A"}</td>
                    <td>${customer.name || "N/A"}</td>
                    <td>${customer.email || "N/A"}</td>
                    <td>${customer.location || "N/A"}</td>
                    <td>${customer.phone_number || "N/A"}</td>
                    <td>
                        <button class="action-btn edit-btn" onclick="editCustomer('${
                          customer._id
                        }')">Edit</button>
                        <button class="action-btn delete-btn" onclick="deleteCustomer('${
                          customer._id
                        }')">Delete</button>
                    </td>
                `;

          tableBody.appendChild(row);
        });
      }

      // Fetch and display suppliers
      async function fetchSuppliers() {
        try {
          const response = await fetch(
            "http://localhost:5000/api/manufacturer/suppliers",
            {
              credentials: "include",
            }
          );
          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }

          const suppliers = await response.json();
          displaySuppliers(suppliers);
        } catch (error) {
          console.error("Error fetching supplier data:", error);
          alert("Error fetching supplier data. Check console for details.");
        }
      }

      function displaySuppliers(suppliers) {
        const tableBody = document.getElementById("supplierTableBody");
        tableBody.innerHTML = "";

        suppliers.forEach((supplier) => {
          const row = document.createElement("tr");

          row.innerHTML = `
                    <td>${supplier.supplierId || "N/A"}</td>
                    <td>${supplier.name || "N/A"}</td>
                    <td>${supplier.email || "N/A"}</td>
                    <td>${supplier.category || "N/A"}</td>
                    <td>${supplier.companyName || "N/A"}</td>
                    <td>${supplier.location || "N/A"}</td>
                    <td>${supplier.phoneNumber || "N/A"}</td>
                    <td>
                        <button class="action-btn edit-btn" onclick="editSupplier('${
                          supplier._id
                        }')">Edit</button>
                        <button class="action-btn delete-btn" onclick="deleteSupplier('${
                          supplier._id
                        }')">Delete</button>
                    </td>
                `;

          tableBody.appendChild(row);
        });
      }

      // Modal functions
      function openModal(modalId) {
        const modal = new bootstrap.Modal(document.getElementById(modalId));
        modal.show();
      }

      function closeModal(modalId) {
        const modal = bootstrap.Modal.getInstance(
          document.getElementById(modalId)
        );
        modal.hide();
      }

      // Open add customer modal
      function openAddCustomerModal() {
        document.getElementById("addCustomerForm").reset();
        openModal("addCustomerModal");
      }

      // Open add supplier modal
      function openAddSupplierModal() {
        document.getElementById("addSupplierForm").reset();
        openModal("addSupplierModal");
      }

      // Add new customer
      async function addNewCustomer() {
        const newCustomer = {
          name: document.getElementById("newCustomerName").value,
          email: document.getElementById("newCustomerEmail").value,
          location: document.getElementById("newCustomerLocation").value,
          phone_number: document.getElementById("newCustomerPhone").value,
          password: document.getElementById("newCustomerPassword").value,
        };

        try {
          const response = await fetch(
            "http://localhost:5000/api/manufacturer/customers",
            {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify(newCustomer),
              credentials: "include",
            }
          );

          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }

          const result = await response.json();
          alert("Customer added successfully!");
          closeModal("addCustomerModal");
          fetchCustomers(); // Refresh the customer list
        } catch (error) {
          console.error("Error adding customer:", error);
          alert(`Error adding customer: ${error.message}`);
        }
      }

      // Add new supplier
      async function addNewSupplier() {
        const newSupplier = {
          name: document.getElementById("newSupplierName").value,
          email: document.getElementById("newSupplierEmail").value,
          category: document.getElementById("newSupplierCategory").value,
          companyName: document.getElementById("newSupplierCompany").value,
          location: document.getElementById("newSupplierLocation").value,
          phoneNumber: document.getElementById("newSupplierPhone").value,
        };

        try {
          const response = await fetch(
            "http://localhost:5000/api/manufacturer/suppliers",
            {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify(newSupplier),
              credentials: "include",
            }
          );

          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }

          const result = await response.json();
          alert("Supplier added successfully!");
          closeModal("addSupplierModal");
          fetchSuppliers(); // Refresh the supplier list
        } catch (error) {
          console.error("Error adding supplier:", error);
          alert(`Error adding supplier: ${error.message}`);
        }
      }

      // Customer edit functions
      async function editCustomer(id) {
        try {
          const response = await fetch(
            `http://localhost:5000/api/manufacturer/customers/${id}`,
            {
              credentials: "include",
            }
          );

          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }

          const customer = await response.json();

          // Fill the form with customer data
          document.getElementById("customerId").value = customer._id;
          document.getElementById("customerName").value = customer.name || "";
          document.getElementById("customerEmail").value = customer.email || "";
          document.getElementById("customerLocation").value =
            customer.location || "";
          document.getElementById("customerPhone").value =
            customer.phone_number || "";
          document.getElementById("customerPassword").value =
            customer.password || "";

          // Open the modal
          openModal("customerModal");
        } catch (error) {
          console.error("Error fetching customer details:", error);
          alert("Error fetching customer details. Check console for details.");
        }
      }

      async function saveCustomerChanges() {
        const id = document.getElementById("customerId").value;
        const updatedData = {
          name: document.getElementById("customerName").value,
          email: document.getElementById("customerEmail").value,
          location: document.getElementById("customerLocation").value,
          phone_number: document.getElementById("customerPhone").value,
          password: document.getElementById("customerPassword").value,
        };

        try {
          const response = await fetch(
            `http://localhost:5000/api/manufacturer/customers/${id}`,
            {
              method: "PUT",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify(updatedData),
              credentials: "include",
            }
          );

          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }

          const result = await response.json();
          alert(result.message || "Customer updated successfully");
          closeModal("customerModal");
          fetchCustomers(); // Refresh the customer list
        } catch (error) {
          console.error("Error updating customer:", error);
          alert(`Error updating customer: ${error.message}`);
        }
      }

      // Supplier edit functions
      async function editSupplier(id) {
        try {
          const response = await fetch(
            `http://localhost:5000/api/manufacturer/suppliers/${id}`,
            {
              credentials: "include",
            }
          );

          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }

          const supplier = await response.json();

          // Fill the form with supplier data
          document.getElementById("supplierId").value = supplier._id;
          document.getElementById("supplierName").value = supplier.name || "";
          document.getElementById("supplierEmail").value = supplier.email || "";
          document.getElementById("supplierCategory").value =
            supplier.category || "";
          document.getElementById("supplierCompany").value =
            supplier.companyName || "";
          document.getElementById("supplierLocation").value =
            supplier.location || "";
          document.getElementById("supplierPhone").value =
            supplier.phoneNumber || "";

          // Open the modal
          openModal("supplierModal");
        } catch (error) {
          console.error("Error fetching supplier details:", error);
          alert("Error fetching supplier details. Check console for details.");
        }
      }

      async function saveSupplierChanges() {
        const id = document.getElementById("supplierId").value;
        const updatedData = {
          name: document.getElementById("supplierName").value,
          email: document.getElementById("supplierEmail").value,
          category: document.getElementById("supplierCategory").value,
          companyName: document.getElementById("supplierCompany").value,
          location: document.getElementById("supplierLocation").value,
          phoneNumber: document.getElementById("supplierPhone").value,
        };

        try {
          const response = await fetch(
            `http://localhost:5000/api/manufacturer/suppliers/${id}`,
            {
              method: "PUT",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify(updatedData),
              credentials: "include",
            }
          );

          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }

          const result = await response.json();
          alert(result.message || "Supplier updated successfully");
          closeModal("supplierModal");
          fetchSuppliers(); // Refresh the supplier list
        } catch (error) {
          console.error("Error updating supplier:", error);
          alert(`Error updating supplier: ${error.message}`);
        }
      }

      async function deleteCustomer(id) {
        if (confirm("Are you sure you want to delete this customer?")) {
          try {
            const response = await fetch(
              `http://localhost:5000/api/manufacturer/customers/${id}`,
              {
                method: "DELETE",
                credentials: "include",
              }
            );

            if (!response.ok) {
              throw new Error(`HTTP error! status: ${response.status}`);
            }

            const result = await response.json();
            if (result.success) {
              alert(result.message);
              fetchCustomers(); // Refresh the customer list
            } else {
              throw new Error(result.error || "Failed to delete customer");
            }
          } catch (error) {
            console.error("Error deleting customer:", error);
            alert(`Error deleting customer: ${error.message}`);
          }
        }
      }

      async function deleteSupplier(id) {
        if (confirm("Are you sure you want to delete this supplier?")) {
          try {
            const response = await fetch(
              `http://localhost:5000/api/manufacturer/suppliers/${id}`,
              {
                method: "DELETE",
                credentials: "include",
              }
            );

            if (!response.ok) {
              const errorData = await response.json();
              throw new Error(
                errorData.error || `HTTP error! status: ${response.status}`
              );
            }

            const result = await response.json();
            alert(result.message);
            fetchSuppliers();
          } catch (error) {
            console.error("Error deleting supplier:", error);
            alert(`Error deleting supplier: ${error.message}`);
          }
        }
      }
    </script>
    <script>
      // Enhanced search function with debouncing
      let searchTimeout;

      function searchTable(inputId, tableBodyId) {
        clearTimeout(searchTimeout);

        searchTimeout = setTimeout(() => {
          const input = document.getElementById(inputId);
          const filter = input.value.trim().toUpperCase();
          const tableBody = document.getElementById(tableBodyId);
          const rows = tableBody.getElementsByTagName("tr");

          // If search is empty, show all rows
          if (filter === "") {
            for (let i = 0; i < rows.length; i++) {
              rows[i].style.display = "";
            }
            return;
          }

          // Search through each row
          for (let i = 0; i < rows.length; i++) {
            const row = rows[i];
            const cells = row.getElementsByTagName("td");
            let rowText = "";

            // Combine all cell text (except actions) for searching
            for (let j = 0; j < cells.length - 1; j++) {
              // Skip last cell (actions)
              const cell = cells[j];
              if (cell) {
                rowText +=
                  (cell.textContent || cell.innerText).toUpperCase() + " ";
              }
            }

            // Show row if search term is found, hide otherwise
            row.style.display = rowText.includes(filter) ? "" : "none";
          }
        }, 300);
      }
    </script>
    <script>
      // Previous script content remains the same until the end

      // Add this new search function at the end of the script
      function searchTable(inputId, tableBodyId) {
        const input = document.getElementById(inputId);
        const filter = input.value.toUpperCase();
        const tableBody = document.getElementById(tableBodyId);
        const rows = tableBody.getElementsByTagName("tr");

        for (let i = 0; i < rows.length; i++) {
          const row = rows[i];
          const cells = row.getElementsByTagName("td");
          let found = false;

          // Skip the first cell (ID) and last cell (actions)
          for (let j = 1; j < cells.length - 1; j++) {
            const cell = cells[j];
            if (cell) {
              const textValue = cell.textContent || cell.innerText;
              if (textValue.toUpperCase().indexOf(filter) > -1) {
                found = true;
                break;
              }
            }
          }

          row.style.display = found ? "" : "none";
        }
      }

      // Make sure to keep all your existing functions below this
    </script>
  </body>
</html>
